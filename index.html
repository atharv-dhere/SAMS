<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMS | Student Academic Monitor System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1; --accent: #a855f7; --bg: #030712;
            --card-bg: rgba(30, 41, 59, 0.6); --text-main: #f8fafc; --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.1); --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; display: flex; min-height: 100vh; overflow-x: hidden; }
        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 20% 30%, #1e1b4b 0%, transparent 40%), radial-gradient(circle at 80% 70%, #2e1065 0%, transparent 40%); z-index: -1; animation: pulseBg 15s ease-in-out infinite alternate; }
        @keyframes pulseBg { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }
        .hidden { display: none !important; }

        /* --- LOGIN SCREEN --- */
        #login-container { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; position: fixed; z-index: 1000; }
        .login-box { background: var(--card-bg); backdrop-filter: blur(25px); padding: 3.5rem 2.5rem; border-radius: 32px; border: 1px solid var(--border); width: 380px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .academic-icon { width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3); }
        .login-box h1 { letter-spacing: 8px; font-size: 2.5rem; font-weight: 800; margin: 0; background: linear-gradient(to bottom, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .input-group { position: relative; margin: 12px 0; }
        input { width: 100%; padding: 14px; background: rgba(15, 23, 42, 0.7); border: 1px solid var(--border); border-radius: 12px; color: white; outline: none; transition: 0.3s; box-sizing: border-box; }
        .pass-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 0.7rem; color: var(--primary); font-weight: bold; }
        button { width: 100%; padding: 14px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.3s; border: none; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }

        .login-footer { margin-top: 2.5rem; border-top: 1px solid var(--border); padding-top: 1.5rem; }
        .dev-text { font-size: 0.65rem; color: var(--text-dim); letter-spacing: 1px; margin-bottom: 8px; opacity: 0.8; }
        .dev-highlight { color: var(--primary); font-weight: 800; }
        .login-quote { font-size: 0.75rem; color: var(--text-main); font-style: italic; opacity: 0.9; line-height: 1.4; padding: 0 10px; margin-bottom: 15px; }
        
        .legal-disclaimer { font-size: 0.55rem; color: var(--text-dim); line-height: 1.3; text-align: center; margin-top: 10px; opacity: 0.6; padding: 0 5px; }

        /* --- DASHBOARD --- */
        #main-dashboard { width: 100%; position: relative; }
        
        /* --- SIDE SWIPE MENU --- */
        .sidebar { 
            position: fixed; top: 0; left: -300px; width: 300px; height: 100vh; background: rgba(15, 23, 42, 0.98); 
            backdrop-filter: blur(20px); border-right: 1px solid var(--border); padding: 1.5rem; display: flex; 
            flex-direction: column; z-index: 2000; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); gap: 10px; box-sizing: border-box;
        }
        .sidebar.open { transform: translateX(300px); }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 1999; display: none; }
        .menu-overlay.show { display: block; }

        .main-content { padding: 5rem 2rem 2rem 2rem; overflow-y: auto; }
        .menu-toggle-btn {
            position: fixed; top: 1.5rem; left: 1.5rem; z-index: 1500; background: var(--card-bg); border: 1px solid var(--border);
            color: white; padding: 10px 15px; border-radius: 12px; cursor: pointer; backdrop-filter: blur(10px); font-weight: 800;
            font-size: 0.7rem; letter-spacing: 1px;
        }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }
        .card { background: var(--card-bg); padding: 1.5rem; border-radius: 20px; border: 1px solid var(--border); backdrop-filter: blur(10px); margin-bottom: 1.5rem; }
        h2 { font-size: 0.7rem; color: var(--accent); text-transform: uppercase; letter-spacing: 2.5px; margin-bottom: 1.2rem; font-weight: 800; }

        .accordion { border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: rgba(255,255,255,0.03); transition: 0.3s; }
        .acc-btn { width: 100%; padding: 14px; background: none; color: var(--text-main); text-align: left; font-size: 0.8rem; font-weight: 600; display: flex; justify-content: space-between; align-items: center; border: none; cursor: pointer; border-radius: 0; }
        .acc-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: rgba(0,0,0,0.2); }
        .acc-content.show { max-height: 300px; padding-bottom: 10px; }
        .acc-inner { padding: 0 14px 10px 14px; font-size: 0.75rem; color: var(--text-dim); }

        /* --- TIMETABLE --- */
        .tt-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .tt-day { background: rgba(22, 25, 48, 0.5); border: 1px solid var(--border); padding: 1.5rem; border-radius: 24px; min-height: 200px; }
        .tt-day.active-day { border: 2px solid var(--accent); background: rgba(45, 27, 105, 0.4); }
        .tt-day h3 { font-size: 1.1rem; margin-top: 0; margin-bottom: 1.5rem; color: #fff; font-weight: 600; }
        .tt-slot { margin-bottom: 1rem; }
        .tt-time { font-size: 0.75rem; color: var(--text-dim); display: block; margin-bottom: 2px; }
        .tt-subject { font-size: 0.85rem; font-weight: 500; color: #fff; }

        .res-btn { background: rgba(255, 255, 255, 0.05); color: var(--text-main); text-align: left; padding: 10px 14px; margin-bottom: 8px; font-size: 0.8rem; border: 1px solid var(--border); display: flex; align-items: center; gap: 10px; transition: 0.2s; cursor: pointer; border-radius: 10px; width: 100%; box-sizing: border-box; }
        .res-btn:hover { background: rgba(99, 102, 241, 0.1); border-color: var(--primary); transform: translateX(5px); }

        .attendance-card { background: rgba(15, 23, 42, 0.4); padding: 1.2rem; border-radius: 18px; border: 1px solid var(--border); }
        .progress-container { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; margin: 12px 0; }
        .progress-bar { height: 100%; width: 0%; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 10px; }
        .list-item { background: rgba(15, 23, 42, 0.4); padding: 12px; border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--primary); font-size: 0.85rem; }

        /* --- AI CHATBOT UI --- */
        #ai-chat-bubble { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 10px 25px rgba(99, 102, 241, 0.5); z-index: 3000; transition: 0.3s; }
        #ai-chat-bubble:hover { transform: scale(1.1) rotate(5deg); }
        #ai-chat-window { position: fixed; bottom: 100px; right: 25px; width: 350px; height: 500px; background: var(--card-bg); backdrop-filter: blur(30px); border: 1px solid var(--border); border-radius: 24px; z-index: 3000; display: flex; flex-direction: column; box-shadow: 0 20px 40px rgba(0,0,0,0.6); overflow: hidden; }
        .chat-header { padding: 1.2rem; background: rgba(255,255,255,0.05); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { padding: 10px 14px; border-radius: 15px; font-size: 0.8rem; max-width: 85%; line-height: 1.4; word-wrap: break-word; }
        .msg-ai { background: rgba(255,255,255,0.1); border: 1px solid var(--border); align-self: flex-start; color: var(--text-main); }
        .msg-user { background: var(--primary); align-self: flex-end; color: white; }
        .chat-input-area { padding: 1rem; background: rgba(0,0,0,0.2); border-top: 1px solid var(--border); display: flex; gap: 8px; }
        .chat-input-area input { padding: 10px; font-size: 0.8rem; flex: 1; }
        .chat-input-area button { width: auto; padding: 0 15px; background: var(--primary); color: white; border-radius: 10px; cursor: pointer; border:none; }
    </style>
</head>
<body>

    <div class="bg-glow"></div>
    <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()"></div>

    <div id="login-container">
        <div class="login-box">
            <div class="academic-icon">ðŸŽ“</div>
            <h1>SAMS</h1>
            <p style="color: var(--text-dim); margin-bottom: 2rem; font-size: 0.75rem; letter-spacing: 2px;">STUDENT ACADEMIC MONITOR</p>
            <div class="input-group"><input type="text" id="username" placeholder="Username"></div>
            <div class="input-group">
                <input type="password" id="password" placeholder="Password">
                <span class="pass-toggle" onclick="togglePass()">SHOW</span>
            </div>
            <button class="btn-primary" onclick="login()">Log In</button>
            <p id="login-error" style="color: var(--danger); font-size: 0.8rem; margin-top: 15px;"></p>

            <div class="login-footer">
                <p class="dev-text">DEVELOPED BY <span class="dev-highlight">ATHARV DHERE X EVRY</span></p>
                <p id="login-quote" class="login-quote"></p>
                <div class="legal-disclaimer">
                    SAMS is an independent student project for educational purposes. Not affiliated with MIT-WPU, SAMS Odisha, or official academic portals. Data provided 'as-is' with no liability for accuracy or loss.
                </div>
            </div>
        </div>
    </div>

    <div id="main-dashboard" class="hidden">
        <button class="menu-toggle-btn" onclick="toggleMenu()">â˜° MENU</button>

        <div id="ai-chat-bubble" onclick="toggleAIChat()">ðŸ¤–</div>
        <div id="ai-chat-window" class="hidden">
            <div class="chat-header">
                <span style="font-size: 0.7rem; font-weight: 800; letter-spacing: 1px;">EVRY ASSISTANT</span>
                <span onclick="toggleAIChat()" style="cursor: pointer; opacity: 0.5;">Ã—</span>
            </div>
            <div class="chat-body" id="chat-body">
                <div class="chat-msg msg-ai">System Online. I am EVRY, your Academic Assistant. How can I help with SAMS today?</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Ask about schedule or exams..." onkeypress="if(event.key==='Enter') sendChat()">
                <button onclick="sendChat()">SEND</button>
            </div>
        </div>

        <aside class="sidebar" id="sidebar">
            <div class="accordion">
                <button class="acc-btn" onclick="toggleAccordion(this)">
                    <span>IDENTITY</span>
                    <span style="font-size:0.6rem">â–¼</span>
                </button>
                <div class="acc-content show">
                    <div class="acc-inner">
                        <h1 id="user-display" style="font-size: 1.3rem; margin: 0 0 5px 0; color: white;">User</h1>
                        <p style="color: var(--primary); font-size: 0.6rem; font-weight: 800; margin: 0; letter-spacing: 2px;">FY MECH ROBO â€¢ SEM II</p>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <button class="acc-btn" onclick="toggleAccordion(this)">
                    <span>TIMELINE</span>
                    <span style="font-size:0.6rem">â–¼</span>
                </button>
                <div class="acc-content">
                    <div class="acc-inner">
                        <div style="line-height: 1.6;">
                            â€¢ Sem 2 starts: <b>5th Jan 26</b><br>
                            â€¢ Mid-Term: <b>9th-20th Mar</b><br>
                            â€¢ End Term: <b>14th May-15th Jun</b>
                        </div>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <button class="acc-btn" onclick="toggleAccordion(this)">
                    <span>RESOURCES</span>
                    <span style="font-size:0.6rem">â–¼</span>
                </button>
                <div class="acc-content">
                    <div class="acc-inner" style="padding-top:10px">
                        <button class="res-btn" onclick="window.open('https://cas.mitwpu.edu.in/')" style="background: var(--accent); color: white; font-weight: 800;">MIT-WPU CAS</button>
                        <button class="res-btn" onclick="window.open('https://chatgpt.com')" style="background: var(--accent); color: white; font-weight: 800;">AI Research</button>
                        <button class="res-btn" onclick="window.open('https://www.youtube.com')" style="background: var(--accent); color: white; font-weight: 800;">YouTube</button>
                        <button class="res-btn" onclick="window.open('https://mitwpu.edu.in/life-wpu/library')" style="background: var(--accent); color: white; font-weight: 800;">Digital Library</button>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <button class="acc-btn" onclick="toggleAccordion(this)">
                    <span>GAMES</span>
                    <span style="font-size:0.6rem">â–¼</span>
                </button>
                <div class="acc-content">
                    <div class="acc-inner" style="padding-top:10px">
                        <button class="res-btn" onclick="window.open('https://play2048.co/')" style="background: var(--accent); color: white; font-weight: 800;">2048 Puzzle</button>
                        <button class="res-btn" onclick="window.open('https://tetris.com/play-tetris')" style="background: var(--accent); color: white; font-weight: 800;">Retro Tetris</button>
                        <button class="res-btn" onclick="window.open('https://chromedino.com/')" style="background: var(--accent); color: white; font-weight: 800;">Dino Run</button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <span onclick="showLegal()" style="font-size: 0.6rem; color: var(--text-dim); text-decoration: underline; cursor: pointer;">Terms & Disclaimer</span>
            </div>

            <button onclick="logout()" style="margin-top: auto; background: var(--danger); color: white; font-weight: 800; font-size: 0.7rem; letter-spacing: 1px; padding: 12px; border-radius: 12px; border:none; cursor:pointer;">Log Out</button>
        </aside>

        <main class="main-content">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">Academic Schedule</h2>
                <div style="text-align: right;">
                    <div id="live-date-header" style="font-size: 0.8rem; font-weight: 800; color: white;">DATE LOADING...</div>
                    <span id="days-remaining" style="font-size: 0.7rem; color: var(--warning); font-weight: 800;"></span>
                </div>
            </div>

            <div class="tt-grid">
                <div class="tt-day" id="day-1">
                    <h3>Mon</h3>
                    <div class="tt-slot"><span class="tt-time">08:30 am - 09:30 am</span><span class="tt-subject">IC (AB 305)</span></div>
                    <div class="tt-slot"><span class="tt-time">09:30 am - 10:30 am</span><span class="tt-subject">EC (AB 305)</span></div>
                    <div class="tt-slot"><span class="tt-time">10:45 am - 12:45 pm</span><span class="tt-subject">EM(1,2,3) (AB 006)</span></div>
                    <div class="tt-slot"><span class="tt-time">01:30 pm - 02:30 pm</span><span class="tt-subject">ESD (AB 105)</span></div>
                </div>
                <div class="tt-day" id="day-2">
                    <h3>Tue</h3>
                    <div class="tt-slot"><span class="tt-time">08:30 am - 09:30 am</span><span class="tt-subject">IEEE (AB 505)</span></div>
                    <div class="tt-slot"><span class="tt-time">09:30 am - 10:30 am</span><span class="tt-subject">IC (AB 505)</span></div>
                    <div class="tt-slot"><span class="tt-time">10:45 am - 12:45 pm</span><span class="tt-subject">CAM(1,2,3) (JN 207)</span></div>
                    <div class="tt-slot"><span class="tt-time">01:30 pm - 03:30 pm</span><span class="tt-subject">IIM(1,2,3) (WS)</span></div>
                </div>
                <div class="tt-day" id="day-3">
                    <h3>Wed</h3>
                    <div class="tt-slot"><span class="tt-time">08:30 am - 09:30 am</span><span class="tt-subject">YOGA (AB 105)</span></div>
                    <div class="tt-slot"><span class="tt-time">10:45 am - 11:45 am</span><span class="tt-subject">IC (AB 707)</span></div>
                    <div class="tt-slot"><span class="tt-time">11:45 am - 12:45 pm</span><span class="tt-subject">IEEE (AB 707)</span></div>
                    <div class="tt-slot"><span class="tt-time">01:30 pm - 03:30 pm</span><span class="tt-subject">CAM(1,2,3) (JN 207)</span></div>
                </div>
                <div class="tt-day" id="day-4">
                    <h3>Thu</h3>
                    <div class="tt-slot"><span class="tt-time">08:30 am - 09:30 am</span><span class="tt-subject">EC (AB 504)</span></div>
                    <div class="tt-slot"><span class="tt-time">09:30 am - 10:30 am</span><span class="tt-subject">EM (AB 504)</span></div>
                    <div class="tt-slot"><span class="tt-time">10:45 am - 12:45 pm</span><span class="tt-subject">EC(1,2,3) (AB 403)</span></div>
                </div>
                <div class="tt-day" id="day-5">
                    <h3>Fri</h3>
                    <div class="tt-slot"><span class="tt-time">10:45 am - 11:45 am</span><span class="tt-subject">IC Tutorial (AB 505)</span></div>
                    <div class="tt-slot"><span class="tt-time">11:45 am - 12:45 pm</span><span class="tt-subject">EM (AB 505)</span></div>
                    <div class="tt-slot"><span class="tt-time">01:30 pm - 03:30 pm</span><span class="tt-subject">IEEE(1,2,3) (AB 506)</span></div>
                    <div class="tt-slot"><span class="tt-time">03:45 pm - 05:45 pm</span><span class="tt-subject">PEACE (AB 003)</span></div>
                </div>
            </div>

            <div class="grid">
                <div class="card" style="grid-column: 1 / -1;">
                    <h2>Attendance tracker</h2>
                    <div id="attendance-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;"></div>
                </div>

                <div class="card">
                    <h2>Subject notes</h2>
                    <div id="subject-notes-container"></div>
                </div>

                <div class="card">
                    <h2>Finance & Tasks</h2>
                    <input type="text" id="todo-input" placeholder="New Task...">
                    <button class="btn-primary" onclick="addTask()" style="margin: 10px 0;">Add Task</button>
                    <div id="todo-list" style="margin-bottom: 2rem;"></div>
                    
                    <input type="number" id="exp-amt" placeholder="Expense Amount (â‚¹)">
                    <button class="btn-primary" onclick="addExpense()" style="margin-top: 10px;">Log Expense</button>
                    <div id="expense-list" style="margin-top: 15px;"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        /* --- GLOBAL DATA --- */
        const users = { 
            "Atharv Dhere": ["1262250205", "1262250204"], 
            "Aryan Lole": "1262253709", 
            "Pavan Dhulipala": "1262252556", 
            "Shubham Rathor": "1262252788", 
            "Aditya Desai": "1262252456",
            "Anshaj Mishra": "1262251082",
            "Harshit Kulthe": "1272251187",
            "Parth Dandnaik": "1262251050", 
            "Aditya Srivastava": "1262250553",
            "Payal Wagh": "1262253971"
        };
        const subjects = ["Integral Calculus", "Engineering Chemistry", "IEEE Engineering", "Engineering Mechanics", "Foundation of Peace", "Yoga-II", "IIM", "Computer Aided Modeling"];
        const quotes = ["The secret of getting ahead is getting started.", "Don't stop until you're proud.", "Success is the sum of small efforts repeated daily.", "Your future is created by what you do today.", "Focus on being productive instead of busy."];
        const SEM_END_DATE = new Date("2026-05-09");

        let currentUser = "";

        /* --- CORE SYSTEM --- */
        window.onload = () => { 
            document.getElementById('login-quote').innerText = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`; 
            checkSession(); 
            updateLiveDate();
        };

        function updateLiveDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
            document.getElementById('live-date-header').innerText = now.toLocaleDateString('en-US', options).toUpperCase();
        }

        function checkSession() {
            const savedSession = sessionStorage.getItem("sams_active_user");
            if(savedSession) { currentUser = savedSession; enterDashboard(); }
        }

        function login() {
            const u = document.getElementById('username').value, p = document.getElementById('password').value;
            if(users[u] && (Array.isArray(users[u]) ? users[u].includes(p) : users[u] === p)) {
                currentUser = u;
                sessionStorage.setItem("sams_active_user", u); 
                enterDashboard();
            } else { document.getElementById('login-error').innerText = "Access Denied"; }
        }

        function enterDashboard() {
            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('main-dashboard').classList.remove('hidden');
            document.getElementById('user-display').innerText = currentUser;
            initDashboard(); loadData(); updateRemainingDays();
        }

        function logout() { sessionStorage.removeItem("sams_active_user"); location.reload(); }
        function togglePass() { const p = document.getElementById('password'); p.type = p.type === 'password' ? 'text' : 'password'; }
        function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('menu-overlay').classList.toggle('show'); }
        function toggleAccordion(btn) { btn.nextElementSibling.classList.toggle('show'); }

        function updateRemainingDays() {
            const diff = SEM_END_DATE - new Date();
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            document.getElementById('days-remaining').innerText = days > 0 ? `${days} DAYS UNTIL MAY 9` : "TERM ENDED";
        }

        /* --- DASHBOARD RENDER --- */
        function initDashboard() {
            const attGrid = document.getElementById('attendance-grid'), noteGrid = document.getElementById('subject-notes-container');
            attGrid.innerHTML = ''; noteGrid.innerHTML = '';
            
            subjects.forEach((sub, index) => {
                const id = sub.replace(/\s/g,'');
                const themeColor = index % 2 === 0 ? 'var(--primary)' : 'var(--accent)';
                
                attGrid.innerHTML += `<div class="attendance-card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b style="font-size:0.85rem;">${sub}</b>
                        <span id="perc-${id}" style="font-weight:800; color:var(--primary);">0%</span>
                    </div>
                    <div class="progress-container"><div id="bar-${id}" class="progress-bar" style="background:var(--primary)"></div></div>
                    <div style="font-size:0.7rem; color:var(--text-dim); margin-bottom:12px;">P: <span id="pres-${id}">0</span> | A: <span id="absent-${id}">0</span> | T: <span id="tot-${id}">0</span></div>
                    <div id="stat-${id}" style="font-size:0.65rem; font-weight:800; margin-bottom:15px;">-</div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 40px; gap:6px;">
                        <button onclick="updateAtt('${sub}', true)" style="background:var(--success); color:white; font-size:0.6rem; padding:8px;">PRESENT</button>
                        <button onclick="updateAtt('${sub}', false)" style="background:var(--danger); color:white; font-size:0.6rem; padding:8px;">ABSENT</button>
                        <button onclick="resetAtt('${sub}')" style="background:rgba(255,255,255,0.1); padding:8px;">â†º</button>
                    </div>
                </div>`;
                
                noteGrid.innerHTML += `<div style="margin-bottom:1.5rem;">
                    <label style="font-size:0.7rem; color:var(--accent); font-weight:800; display:block; margin-bottom:5px;">${sub}</label>
                    <div style="display:flex; gap:5px;">
                        <input id="note-in-${id}" placeholder="Type note..." style="padding:8px; font-size:0.8rem;">
                        <button onclick="addNote('${sub}')" style="background:${themeColor}; color:white; width:auto; padding:0 15px; font-size:0.7rem;">SAVE</button>
                    </div>
                    <div id="note-list-${id}" style="margin-top:10px;"></div>
                </div>`;
            });

            const d = new Date().getDay(); 
            if(d >= 1 && d <= 5) document.getElementById(`day-${d}`).classList.add('active-day');
        }

        /* --- DATA PERSISTENCE --- */
        function updateAtt(sub, isP, silent=false) {
            if (new Date() > SEM_END_DATE && !silent) { alert("Instructional period ended. Attendance is locked."); return; }
            const id = sub.replace(/\s/g,'');
            let p = parseInt(document.getElementById(`pres-${id}`).innerText);
            let a = parseInt(document.getElementById(`absent-${id}`).innerText);
            let t = parseInt(document.getElementById(`tot-${id}`).innerText);
            
            if(!silent) { if(isP) p++; else a++; t++; }
            const perc = t>0 ? ((p/t)*100).toFixed(1) : 0;
            document.getElementById(`pres-${id}`).innerText = p;
            document.getElementById(`absent-${id}`).innerText = a;
            document.getElementById(`tot-${id}`).innerText = t;
            document.getElementById(`perc-${id}`).innerText = perc + "%";
            
            const bar = document.getElementById(`bar-${id}`), stat = document.getElementById(`stat-${id}`);
            bar.style.width = perc + "%";
            if(perc < 80) { 
                const n = Math.ceil((0.8*t - p)/0.2); 
                stat.innerText = `NEED ${n} CLASSES`; stat.style.color = "var(--danger)"; bar.style.background="var(--danger)"; 
            } else { 
                const s = Math.floor(p/0.8 - t); 
                stat.innerText = s>0 ? `CAN SKIP ${s}` : "SAFE"; stat.style.color = "var(--success)"; bar.style.background="var(--success)"; 
            }
            if(!silent) saveData();
        }

        function saveData() {
            const data = { attendance: {}, notes: {}, tasks: document.getElementById('todo-list').innerHTML, expenses: document.getElementById('expense-list').innerHTML };
            subjects.forEach(sub => {
                const id = sub.replace(/\s/g,'');
                data.attendance[id] = { p: document.getElementById(`pres-${id}`).innerText, a: document.getElementById(`absent-${id}`).innerText, t: document.getElementById(`tot-${id}`).innerText };
                data.notes[id] = document.getElementById(`note-list-${id}`).innerHTML;
            });
            localStorage.setItem(`sams_v101_${currentUser}`, JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem(`sams_v101_${currentUser}`); if(!saved) return;
            const data = JSON.parse(saved);
            Object.keys(data.attendance).forEach(id => {
                if(document.getElementById(`pres-${id}`)) {
                    document.getElementById(`pres-${id}`).innerText = data.attendance[id].p;
                    document.getElementById(`absent-${id}`).innerText = data.attendance[id].a || 0;
                    document.getElementById(`tot-${id}`).innerText = data.attendance[id].t;
                    updateAtt(id, false, true);
                    if(data.notes[id]) document.getElementById(`note-list-${id}`).innerHTML = data.notes[id];
                }
            });
            document.getElementById('todo-list').innerHTML = data.tasks || "";
            document.getElementById('expense-list').innerHTML = data.expenses || "";
        }

        /* --- FEATURES --- */
        function addNote(sub) {
            const id = sub.replace(/\s/g,''), val = document.getElementById(`note-in-${id}`).value; if(!val) return;
            const div = document.createElement('div'); div.className = 'list-item';
            div.innerHTML = `<span>${val}</span><span onclick="this.parentElement.remove(); saveData();" style="cursor:pointer; color:var(--danger)">Ã—</span>`;
            document.getElementById(`note-list-${id}`).prepend(div); document.getElementById(`note-in-${id}`).value = ''; saveData();
        }
        function addTask() { 
            const v = document.getElementById('todo-input').value; if(!v) return;
            const d = document.createElement('div'); d.className = 'list-item';
            d.innerHTML = `<span>${v}</span><span onclick="this.parentElement.remove(); saveData();" style="cursor:pointer; color:var(--danger)">Ã—</span>`;
            document.getElementById('todo-list').prepend(d); document.getElementById('todo-input').value = ''; saveData();
        }
        function addExpense() { 
            const v = document.getElementById('exp-amt').value; if(!v) return;
            const d = document.createElement('div'); d.className = 'list-item';
            d.innerHTML = `<span>Logged Expense</span><b>â‚¹${v}</b>`;
            document.getElementById('expense-list').prepend(d); document.getElementById('exp-amt').value = ''; saveData();
        }
        function resetAtt(sub) { 
            const id = sub.replace(/\s/g,''); document.getElementById(`pres-${id}`).innerText="0"; document.getElementById(`absent-${id}`).innerText="0"; document.getElementById(`tot-${id}`).innerText="0"; 
            updateAtt(sub, false, true); saveData(); 
        }
        function showLegal() { alert("SAMSbyAD LEGAL NOTICE:\n\n1.Non-Affiliation: SAMS and EVRY are independent projects by Atharv Dhere.\n\n2. Not affiliated with MIT-WPU, SAMS Odisha, or any official government portal.\n\n3. Accuracy: All data is user-provided. This is a predictive tool, not an official academic record. Use at your own risk; the developer is not liable for academic consequences.\n\n4. Privacy: Data is stored locally on your device. Clearing your browser cache will delete all information.\n\n5. Copyright: Â© 2026 Atharv Dhere. All rights reserved."); }

        /* --- LOCAL AI LOGIC (EVRY) --- */
        function toggleAIChat() {
            document.getElementById('ai-chat-window').classList.toggle('hidden');
        }

        function sendChat() {
            const input = document.getElementById('chat-input');
            const body = document.getElementById('chat-body');
            const msg = input.value.trim().toLowerCase();
            if(!msg) return;

            body.innerHTML += `<div class="chat-msg msg-user">${input.value}</div>`;
            input.value = '';
            body.scrollTop = body.scrollHeight;

            setTimeout(() => {
                let response = "";
                const academicKeywords = ["exam", "term", "subject", "study", "schedule", "timetable", "attendance", "calculus", "mechanics", "chemistry", "ieee", "yoga"];
                const isAcademic = academicKeywords.some(keyword => msg.includes(keyword)) || msg.includes("hi") || msg.includes("hello");

                if (isAcademic) {
                    if (msg.includes("hi") || msg.includes("hello")) {
                        response = `Greetings ${currentUser}. I am EVRY. How may I assist with your SAMS data?`;
                    } else if (msg.includes("exam") || msg.includes("term")) {
                        response = "Academic Timeline: Mid-Terms (Mar 9-20), End-Terms (May 14-Jun 15).";
                    } else if (msg.includes("attendance")) {
                        response = "Tracking active. Please refer to the Attendance Module. Requirement: >80% for compliance.";
                    } else {
                        response = "I am currently optimized for academic SAMS data. For specific syllabus details, please refer to the Resource tab.";
                    }
                } else {
                    response = "[SYSTEM]: General queries are locked in Beta. Full EVRY deployment scheduled after Feb 2nd 2026.";
                }

                body.innerHTML += `<div class="chat-msg msg-ai">${response}</div>`;
                body.scrollTop = body.scrollHeight;
            }, 500);
        }
    </script>
</body>
</html>
